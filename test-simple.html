<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–π –≤–µ—Ä—Å–∏–∏ CRM</h1>
    <div id="results"></div>
    
    <script src="js/utils/constants.js"></script>
    <script src="js/modules/dataManager.js"></script>
    <script>
        const results = document.getElementById('results');
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        // –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        try {
            addResult('üîß –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...', 'info');
            
            // –û—á–∏—â–∞–µ–º localStorage –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞
            localStorage.removeItem('crmData');
            addResult('üóëÔ∏è localStorage –æ—á–∏—â–µ–Ω', 'info');
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö
            DataManager.load();
            addResult('‚úÖ DataManager.load() –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∞–¥–º–∏–Ω —Å–æ–∑–¥–∞–ª—Å—è
            const admin = DataManager.getUsers().find(u => u.isAdmin);
            if (admin) {
                addResult(`üë§ –ê–¥–º–∏–Ω –Ω–∞–π–¥–µ–Ω: ${admin.name}`, 'success');
            } else {
                addResult('‚ùå –ê–¥–º–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            }
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
            const testProcess = {
                id: Date.now(),
                name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å',
                order: 1
            };
            
            DataManager.addProcess(testProcess);
            addResult('üìã –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è
            const processes = DataManager.getProcesses();
            if (processes.length > 0 && processes.find(p => p.name === '–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å')) {
                addResult(`‚úÖ –ü—Ä–æ—Ü–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –í—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: ${processes.length}`, 'success');
            } else {
                addResult('‚ùå –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è!', 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            const savedData = localStorage.getItem('crmData');
            if (savedData) {
                const parsed = JSON.parse(savedData);
                if (parsed.processes && parsed.processes.length > 0) {
                    addResult('üíæ –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage', 'success');
                } else {
                    addResult('‚ùå –ü—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –≤ localStorage!', 'error');
                }
            } else {
                addResult('‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage!', 'error');
            }
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É
            addResult('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö...', 'info');
            DataManager.load();
            
            const processesAfterReload = DataManager.getProcesses();
            if (processesAfterReload.length > 0 && processesAfterReload.find(p => p.name === '–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å')) {
                addResult('‚úÖ –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏', 'success');
            } else {
                addResult('‚ùå –î–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏!', 'error');
            }
            
            addResult('üéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!', 'success');
            
        } catch (error) {
            addResult(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
        }
    </script>
</body>
</html>
