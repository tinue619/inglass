<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π - Inglass CRM</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 5px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .btn { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π Inglass CRM</h1>
    
    <div id="results"></div>
    
    <button class="btn btn-primary" onclick="testModules()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥—É–ª–∏</button>
    <button class="btn btn-primary" onclick="testBoardModule()">üìã –¢–µ—Å—Ç BoardModule</button>
    <button class="btn btn-primary" onclick="forceReloadBoardModule()">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å BoardModule</button>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ —á—Ç–æ –∏ –≤ index.html -->
    <script src="js/utils/constants.js"></script>
    <script src="js/utils/phoneUtils.js"></script>
    <script src="js/utils/contactEntities.js"></script>
    <script src="js/utils/orderUtils.js"></script>
    <script src="js/services/APIService.js"></script>
    <script src="js/modules/dataManager.js"></script>
    <script src="js/modules/modalModule.js"></script>
    <script src="js/modules/authModule.js"></script>
    <script src="js/modules/boardModule.js"></script>
    <script src="js/modules/defectModule.js"></script>
    <script src="js/modules/adminModule.js"></script>
    <script src="js/modules/appModule.js"></script>

    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            results.appendChild(div);
            console.log(`[${type}] ${message}`);
        }
        
        function testModules() {
            document.getElementById('results').innerHTML = '';
            addResult('üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –º–æ–¥—É–ª–µ–π...', 'info');
            
            const modules = [
                { name: 'APP_CONSTANTS', obj: window.APP_CONSTANTS },
                { name: 'PhoneUtils', obj: window.PhoneUtils },
                { name: 'Phone', obj: window.Phone },
                { name: 'OrderUtils', obj: window.OrderUtils },
                { name: 'APIService', obj: window.APIService },
                { name: 'DataManager', obj: window.DataManager },
                { name: 'ModalModule', obj: window.ModalModule },
                { name: 'AuthModule', obj: window.AuthModule },
                { name: 'BoardModule', obj: window.BoardModule },
                { name: 'DefectModule', obj: window.DefectModule },
                { name: 'AdminModule', obj: window.AdminModule },
                { name: 'AppModule', obj: window.AppModule }
            ];
            
            modules.forEach(module => {
                if (module.obj) {
                    addResult(`‚úÖ ${module.name} –∑–∞–≥—Ä—É–∂–µ–Ω`, 'success');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
                    if (module.name === 'BoardModule' && module.obj.showProcessBoard) {
                        addResult(`  ‚úÖ BoardModule.showProcessBoard() –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    }
                    if (module.name === 'DataManager' && module.obj.load) {
                        addResult(`  ‚úÖ DataManager.load() –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    }
                } else {
                    addResult(`‚ùå ${module.name} –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω!`, 'error');
                }
            });
            
            addResult('üèÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'info');
        }
        
        function testBoardModule() {
            addResult('üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ BoardModule...', 'info');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ BoardModule —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (!window.BoardModule) {
                addResult('‚ùå BoardModule –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ window!', 'error');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã
                addResult('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã...', 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω
                const scripts = document.querySelectorAll('script[src*="boardModule"]');
                if (scripts.length > 0) {
                    addResult(`‚úÖ –°–∫—Ä–∏–ø—Ç boardModule.js –Ω–∞–π–¥–µ–Ω –≤ DOM (${scripts.length})`, 'success');
                } else {
                    addResult('‚ùå –°–∫—Ä–∏–ø—Ç boardModule.js –ù–ï –Ω–∞–π–¥–µ–Ω –≤ DOM!', 'error');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–∫–Ω–æ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å—Ö–æ–∂–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
                const possibleNames = ['BoardModule', 'boardModule', 'Board', 'board'];
                possibleNames.forEach(name => {
                    if (window[name]) {
                        addResult(`‚ÑπÔ∏è –ù–∞–π–¥–µ–Ω –æ–±—ä–µ–∫—Ç window.${name}`, 'info');
                    }
                });
                
                return;
            }
            
            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é
                if (typeof BoardModule.test === 'function') {
                    const testResult = BoardModule.test();
                    addResult(`‚úÖ BoardModule.test() –≤–µ—Ä–Ω—É–ª: ${testResult}`, 'success');
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º DataManager
                await DataManager.load();
                addResult('‚úÖ DataManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–¥–º–∏–Ω–∞ –∫–∞–∫ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const admin = DataManager.getUsers().find(u => u.isAdmin);
                if (admin) {
                    DataManager.setCurrentUser(admin);
                    addResult('‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', 'success');
                } else {
                    addResult('‚ùå –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                let testContainer = document.getElementById('mainContent');
                if (!testContainer) {
                    testContainer = document.createElement('div');
                    testContainer.id = 'mainContent';
                    testContainer.style.cssText = 'width: 100%; min-height: 300px; border: 2px solid #007bff; margin: 10px 0; padding: 20px; border-radius: 8px;';
                    document.body.appendChild(testContainer);
                    addResult('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä mainContent —Å–æ–∑–¥–∞–Ω', 'success');
                }
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º showProcessBoard
                addResult('üìã –ó–∞–ø—É—Å–∫–∞–µ–º BoardModule.showProcessBoard()...', 'info');
                BoardModule.showProcessBoard();
                addResult('‚úÖ BoardModule.showProcessBoard() –≤—ã–ø–æ–ª–Ω–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç —Å–æ–∑–¥–∞–ª—Å—è
                if (testContainer.children.length > 0) {
                    addResult(`‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω (${testContainer.children.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)`, 'success');
                    testContainer.style.display = 'block';
                } else {
                    addResult('‚ö†Ô∏è –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å–∫–∏ –ø—É—Å—Ç', 'info');
                }
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ BoardModule: ${error.message}`, 'error');
                console.error('–ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(() => {
                addResult('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –º–æ–¥—É–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã', 'info');
                testModules();
            }, 100);
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ BoardModule
        function forceReloadBoardModule() {
            addResult('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ BoardModule...', 'info');
            
            try {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Å–∫—Ä–∏–ø—Ç
                const oldScript = document.querySelector('script[src*="boardModule"]');
                if (oldScript) {
                    oldScript.remove();
                    addResult('‚úÖ –°—Ç–∞—Ä—ã–π —Å–∫—Ä–∏–ø—Ç boardModule —É–¥–∞–ª–µ–Ω', 'success');
                }
                
                // –û—á–∏—â–∞–µ–º window.BoardModule
                if (window.BoardModule) {
                    delete window.BoardModule;
                    addResult('‚úÖ window.BoardModule –æ—á–∏—â–µ–Ω', 'success');
                }
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
                const newScript = document.createElement('script');
                newScript.src = `js/modules/boardModule.js?v=${Date.now()}`;
                newScript.onload = () => {
                    addResult('‚úÖ BoardModule –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –º–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
                    if (window.BoardModule) {
                        addResult('‚úÖ window.BoardModule —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                        if (typeof window.BoardModule.showProcessBoard === 'function') {
                            addResult('‚úÖ BoardModule.showProcessBoard() –¥–æ—Å—Ç—É–ø–Ω–∞', 'success');
                        }
                    } else {
                        addResult('‚ùå window.BoardModule –≤—Å–µ –µ—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                    }
                };
                newScript.onerror = () => {
                    addResult('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ BoardModule', 'error');
                };
                
                document.head.appendChild(newScript);
                addResult('‚ÑπÔ∏è –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω, –æ–∂–∏–¥–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É...', 'info');
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
