<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ - Inglass CRM</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background 0.2s;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .btn.success {
            background: #28a745;
        }
        .btn.success:hover {
            background: #1e7e34;
        }
        .btn.danger {
            background: #dc3545;
        }
        .btn.danger:hover {
            background: #c82333;
        }
        .actions {
            text-align: center;
            margin: 30px 0;
        }
        .info-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        li {
            margin: 5px 0;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h1>
        
        <div id="status"></div>
        
        <div class="info-box">
            <h3>–ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ:</h3>
            <ul>
                <li><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (3):</strong>
                    <ul>
                        <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (—Ç–µ–ª: +7 777 777 7777, –ø–∞—Ä–æ–ª—å: 1488)</li>
                        <li>–ú–µ–Ω–µ–¥–∂–µ—Ä –ê–Ω–Ω–∞ (—Ç–µ–ª: +7 111 111 1111, –ø–∞—Ä–æ–ª—å: 1111)</li>
                        <li>–ú–∞—Å—Ç–µ—Ä –ò–≤–∞–Ω (—Ç–µ–ª: +7 222 222 2222, –ø–∞—Ä–æ–ª—å: 2222)</li>
                    </ul>
                </li>
                <li><strong>–ü—Ä–æ—Ü–µ—Å—Å—ã (5):</strong> –ü—Ä–∏–µ–º –∑–∞–∫–∞–∑–∞, –ó–∞–º–µ—Ä, –†–µ–∑–∫–∞ —Å—Ç–µ–∫–ª–∞, –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–æ–º–∫–∏, –£–ø–∞–∫–æ–≤–∫–∞</li>
                <li><strong>–ò–∑–¥–µ–ª–∏—è (3):</strong> –°—Ç–µ–∫–ª–æ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–µ, –ó–µ—Ä–∫–∞–ª–æ, –°—Ç–µ–∫–ª–æ–ø–∞–∫–µ—Ç</li>
                <li><strong>–ó–∞–∫–∞–∑—ã (3):</strong> –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Å–æ–±—ã—Ç–∏–π</li>
            </ul>
        </div>
        
        <div class="actions">
            <button id="checkBtn" class="btn" onclick="checkServerStatus()">
                üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
            </button>
            
            <button id="createBtn" class="btn success" onclick="createTestData()" disabled>
                ‚ú® –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            </button>
            
            <button id="clearBtn" class="btn danger" onclick="clearData()">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>
        
        <div class="info-box">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</h3>
            <ol>
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (start-server.bat)</li>
                <li>–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</li>
                <li>–ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ" –¥–ª—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã</li>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (index.html) –∏ –≤–æ–π–¥–∏—Ç–µ –ø–æ–¥ –æ–¥–Ω–∏–º –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
            </ol>
        </div>
    </div>

    <script src="create-test-data.js"></script>
    <script>
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function setLoading(buttonId, loading = true) {
            const btn = document.getElementById(buttonId);
            if (loading) {
                btn.innerHTML = '<span class="loading"></span>' + btn.textContent;
                btn.disabled = true;
            } else {
                btn.innerHTML = btn.textContent.replace('‚ü≥ ', '');
                btn.disabled = false;
            }
        }

        async function checkServerStatus() {
            setLoading('checkBtn', true);
            showStatus('üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º...', 'info');
            
            try {
                const isOnline = await checkServer();
                if (isOnline) {
                    showStatus('‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω! –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.', 'success');
                    document.getElementById('createBtn').disabled = false;
                } else {
                    showStatus('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∫–æ–º–∞–Ω–¥–æ–π start-server.bat', 'error');
                    document.getElementById('createBtn').disabled = true;
                }
            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
                document.getElementById('createBtn').disabled = true;
            } finally {
                setLoading('checkBtn', false);
            }
        }

        async function createTestData() {
            setLoading('createBtn', true);
            showStatus('üîÑ –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...', 'info');
            
            try {
                const response = await fetch('http://localhost:3001/api/data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    showStatus(`
                        ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!<br>
                        üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${testData.users.length}<br>
                        ‚öôÔ∏è –ü—Ä–æ—Ü–µ—Å—Å–æ–≤: ${testData.processes.length}<br>
                        üì¶ –ò–∑–¥–µ–ª–∏–π: ${testData.products.length}<br>
                        üìã –ó–∞–∫–∞–∑–æ–≤: ${testData.orders.length}<br><br>
                        <strong>–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤–æ–π—Ç–∏ –ø–æ–¥ –ª—é–±—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º!</strong>
                    `, 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ${error.message}`, 'error');
            } finally {
                setLoading('createBtn', false);
            }
        }

        async function clearData() {
            if (!confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                return;
            }
            
            setLoading('clearBtn', true);
            showStatus('üîÑ –û—á–∏—â–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ...', 'info');
            
            try {
                const emptyData = {
                    users: [{
                        id: 1,
                        name: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
                        phone: "+7 777 777 7777",
                        password: "1488",
                        isAdmin: true,
                        processes: [],
                        canCreateOrders: true
                    }],
                    processes: [],
                    products: [],
                    orders: [],
                    lastSync: new Date().toISOString()
                };
                
                const response = await fetch('http://localhost:3001/api/data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(emptyData)
                });
                
                if (response.ok) {
                    showStatus('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã! –û—Å—Ç–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`, 'error');
            } finally {
                setLoading('clearBtn', false);
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(checkServerStatus, 500);
        });
    </script>
</body>
</html>
