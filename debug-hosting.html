<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM System - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f0f0f0; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
        }
        .status { 
            padding: 10px; 
            margin: 5px 0; 
            border-radius: 4px; 
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px; 
        }
        pre { 
            background: #f8f9fa; 
            padding: 10px; 
            border-radius: 4px; 
            overflow-x: auto; 
            font-size: 12px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß CRM System - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –•–æ—Å—Ç–∏–Ω–≥–∞</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ.</p>
        
        <div id="diagnostics"></div>
        
        <button class="btn" onclick="runDiagnostics()">üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
        <button class="btn" onclick="testAPI()">üåê –¢–µ—Å—Ç API</button>
        <button class="btn" onclick="testModules()">üì¶ –¢–µ—Å—Ç –º–æ–¥—É–ª–µ–π</button>
    </div>

    <script>
        function log(message, type = 'info') {
            const div = document.getElementById('diagnostics');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            div.innerHTML += `<div class="status ${className}">${message}</div>`;
            console.log(message);
        }

        function runDiagnostics() {
            document.getElementById('diagnostics').innerHTML = '';
            
            log('üöÄ –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...', 'info');
            
            // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            log(`üìç –¢–µ–∫—É—â–∏–π URL: ${window.location.href}`, 'info');
            log(`üåê –î–æ–º–µ–Ω: ${window.location.origin}`, 'info');
            log(`üì± User Agent: ${navigator.userAgent.substring(0, 50)}...`, 'info');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤
            const testFiles = [
                'css/styles.css',
                'js/utils/config.js',
                'js/core/app.js',
                'js/modules/authModule.js'
            ];
            
            log('üìÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤:', 'info');
            
            testFiles.forEach(file => {
                fetch(file)
                    .then(response => {
                        if (response.ok) {
                            log(`‚úÖ ${file} - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è`, 'success');
                        } else {
                            log(`‚ùå ${file} - –æ—à–∏–±–∫–∞ ${response.status}`, 'error');
                        }
                    })
                    .catch(error => {
                        log(`‚ùå ${file} - –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: ${error.message}`, 'error');
                    });
            });
        }

        function testAPI() {
            log('üåê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...', 'info');
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º API URL
            const apiUrl = window.location.origin + '/api';
            log(`üîó API URL: ${apiUrl}`, 'info');
            
            // –¢–µ—Å—Ç health check
            fetch(`${apiUrl}/health`)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error(`HTTP ${response.status}`);
                })
                .then(data => {
                    log(`‚úÖ API Health: ${JSON.stringify(data)}`, 'success');
                })
                .catch(error => {
                    log(`‚ùå API Health –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                });
            
            // –¢–µ—Å—Ç –¥–∞–Ω–Ω—ã—Ö
            fetch(`${apiUrl}/data`)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error(`HTTP ${response.status}`);
                })
                .then(data => {
                    log(`‚úÖ API Data: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ${data.data?.users?.length || 0}`, 'success');
                })
                .catch(error => {
                    log(`‚ùå API Data –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                });
        }

        function testModules() {
            log('üì¶ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π...', 'info');
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
            const modules = [
                'js/utils/constants.js',
                'js/utils/config.js',
                'js/core/entities.js',
                'js/core/managers.js',
                'js/core/app.js'
            ];
            
            let loadedCount = 0;
            let totalCount = modules.length;
            
            modules.forEach((module, index) => {
                const script = document.createElement('script');
                script.src = module;
                
                script.onload = () => {
                    loadedCount++;
                    log(`‚úÖ ${module} - –∑–∞–≥—Ä—É–∂–µ–Ω`, 'success');
                    
                    if (loadedCount === totalCount) {
                        log('üéâ –í—Å–µ –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã! –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã...', 'success');
                        
                        setTimeout(() => {
                            const globals = ['APP_CONSTANTS', 'APP_CONFIG', 'User', 'Order', 'App', 'DataManager'];
                            globals.forEach(global => {
                                if (typeof window[global] !== 'undefined') {
                                    log(`‚úÖ ${global} –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                                } else {
                                    log(`‚ùå ${global} –Ω–µ –Ω–∞–π–¥–µ–Ω`, 'error');
                                }
                            });
                        }, 1000);
                    }
                };
                
                script.onerror = () => {
                    log(`‚ùå ${module} - –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏`, 'error');
                };
                
                document.head.appendChild(script);
            });
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        window.onload = () => {
            setTimeout(runDiagnostics, 500);
        };
    </script>
</body>
</html>
