<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π - Inglass CRM</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 5px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .btn { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π Inglass CRM</h1>
    
    <div id="results"></div>
    
    <button class="btn btn-primary" onclick="testModules()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥—É–ª–∏</button>
    <button class="btn btn-primary" onclick="testBoardModule()">üìã –¢–µ—Å—Ç BoardModule</button>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ —á—Ç–æ –∏ –≤ index.html -->
    <script src="js/utils/constants.js"></script>
    <script src="js/utils/phoneUtils.js"></script>
    <script src="js/utils/contactEntities.js"></script>
    <script src="js/utils/orderUtils.js"></script>
    <script src="js/services/APIService.js"></script>
    <script src="js/modules/dataManager.js"></script>
    <script src="js/modules/modalModule.js"></script>
    <script src="js/modules/authModule.js"></script>
    <script src="js/modules/boardModule.js"></script>
    <script src="js/modules/defectModule.js"></script>
    <script src="js/modules/adminModule.js"></script>
    <script src="js/modules/appModule.js"></script>

    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            results.appendChild(div);
            console.log(`[${type}] ${message}`);
        }
        
        function testModules() {
            document.getElementById('results').innerHTML = '';
            addResult('üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –º–æ–¥—É–ª–µ–π...', 'info');
            
            const modules = [
                { name: 'APP_CONSTANTS', obj: window.APP_CONSTANTS },
                { name: 'PhoneUtils', obj: window.PhoneUtils },
                { name: 'Phone', obj: window.Phone },
                { name: 'OrderUtils', obj: window.OrderUtils },
                { name: 'APIService', obj: window.APIService },
                { name: 'DataManager', obj: window.DataManager },
                { name: 'ModalModule', obj: window.ModalModule },
                { name: 'AuthModule', obj: window.AuthModule },
                { name: 'BoardModule', obj: window.BoardModule },
                { name: 'DefectModule', obj: window.DefectModule },
                { name: 'AdminModule', obj: window.AdminModule },
                { name: 'AppModule', obj: window.AppModule }
            ];
            
            modules.forEach(module => {
                if (module.obj) {
                    addResult(`‚úÖ ${module.name} –∑–∞–≥—Ä—É–∂–µ–Ω`, 'success');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
                    if (module.name === 'BoardModule' && module.obj.showProcessBoard) {
                        addResult(`  ‚úÖ BoardModule.showProcessBoard() –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    }
                    if (module.name === 'DataManager' && module.obj.load) {
                        addResult(`  ‚úÖ DataManager.load() –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    }
                } else {
                    addResult(`‚ùå ${module.name} –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω!`, 'error');
                }
            });
            
            addResult('üèÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'info');
        }
        
        async function testBoardModule() {
            addResult('üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ BoardModule...', 'info');
            
            if (!window.BoardModule) {
                addResult('‚ùå BoardModule –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                return;
            }
            
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º DataManager
                await DataManager.load();
                addResult('‚úÖ DataManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–¥–º–∏–Ω–∞ –∫–∞–∫ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const admin = DataManager.getUsers().find(u => u.isAdmin);
                if (admin) {
                    DataManager.setCurrentUser(admin);
                    addResult('‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', 'success');
                } else {
                    addResult('‚ùå –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                const testContainer = document.createElement('div');
                testContainer.id = 'mainContent';
                testContainer.style.cssText = 'width: 100%; height: 300px; border: 1px solid #ccc; margin: 10px 0; display: none;';
                document.body.appendChild(testContainer);
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º showProcessBoard
                BoardModule.showProcessBoard();
                addResult('‚úÖ BoardModule.showProcessBoard() –≤—ã–ø–æ–ª–Ω–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç —Å–æ–∑–¥–∞–ª—Å—è
                if (testContainer.innerHTML.trim()) {
                    addResult('‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω', 'success');
                } else {
                    addResult('‚ö†Ô∏è –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å–∫–∏ –ø—É—Å—Ç (–≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)', 'info');
                }
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ BoardModule: ${error.message}`, 'error');
                console.error('–ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(() => {
                addResult('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –º–æ–¥—É–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã', 'info');
                testModules();
            }, 100);
        });
    </script>
</body>
</html>
