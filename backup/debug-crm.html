<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM System - Debug</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app">
        <div style="padding: 20px;">
            <h1>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ CRM</h1>
            <button onclick="runDiagnostics()" class="btn btn-primary">–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
            <button onclick="fixAndRestart()" class="btn btn-success">–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
            <div id="results" style="margin-top: 20px;"></div>
        </div>
    </div>
    
    <script src="js/data.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/board.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        function runDiagnostics() {
            const results = document.getElementById('results');
            let report = '<h3>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:</h3>';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö
                loadData();
                report += `<p>‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</p>`;
                report += `<p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${data.users.length}</p>`;
                report += `<p>–ü—Ä–æ—Ü–µ—Å—Å–æ–≤: ${data.processes.length}</p>`;
                report += `<p>–ò–∑–¥–µ–ª–∏–π: ${data.products.length}</p>`;
                report += `<p>–ó–∞–∫–∞–∑–æ–≤: ${data.orders.length}</p>`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω–∞
                const admin = data.users.find(u => u.isAdmin);
                if (admin) {
                    report += `<p>‚úÖ –ê–¥–º–∏–Ω –Ω–∞–π–¥–µ–Ω: ${admin.name}</p>`;
                } else {
                    report += `<p>‚ùå –ê–¥–º–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω</p>`;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏
                if (typeof showAdminPanel === 'function') {
                    report += `<p>‚úÖ showAdminPanel –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</p>`;
                } else {
                    report += `<p>‚ùå showAdminPanel –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</p>`;
                }
                
                if (typeof renderAdminContent === 'function') {
                    report += `<p>‚úÖ renderAdminContent –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</p>`;
                } else {
                    report += `<p>‚ùå renderAdminContent –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</p>`;
                }
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
                report += `<p><button onclick="testDemoData()" class="btn btn-secondary">–°–æ–∑–¥–∞—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ</button></p>`;
                
            } catch (error) {
                report += `<p>‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
                console.error('–û—à–∏–±–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:', error);
            }
            
            results.innerHTML = report;
        }
        
        function testDemoData() {
            try {
                createDemoData();
                setTimeout(() => {
                    runDiagnostics();
                }, 500);
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö: ' + error.message);
            }
        }
        
        function fixAndRestart() {
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            localStorage.clear();
            sessionStorage.clear();
            
            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞
            location.href = 'index.html';
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        window.addEventListener('load', () => {
            setTimeout(runDiagnostics, 500);
        });
    </script>
</body>
</html>