<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест функции брака</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .btn { padding: 10px 20px; margin: 10px; cursor: pointer; }
        .btn-warning { background: orange; color: white; border: none; }
    </style>
</head>
<body>
    <h1>Тест функции отправки в брак</h1>
    
    <button class="btn btn-warning" onclick="testDefectFunction()">Тест функции showDefectModal</button>
    
    <div id="status"></div>

    <script>
        // Минимальные тестовые данные
        const data = {
            currentUser: { name: 'Тестовый пользователь', id: 1 },
            orders: [
                {
                    id: 1,
                    number: '250117-001',
                    productId: 1,
                    currentProcessId: 2,
                    customerName: 'Тест клиент'
                }
            ],
            products: [
                {
                    id: 1,
                    name: 'Тестовое изделие',
                    processes: [1, 2, 3]
                }
            ],
            processes: [
                { id: 1, name: 'Прием заказа', order: 1 },
                { id: 2, name: 'Резка', order: 2 },
                { id: 3, name: 'Упаковка', order: 3 }
            ]
        };

        // Заглушки функций
        function addOrderHistoryEvent() { console.log('addOrderHistoryEvent вызвана'); }
        function saveData() { console.log('saveData вызвана'); }
        function renderProcessBoard() { console.log('renderProcessBoard вызвана'); }

        // Простая функция showModal
        function showModal(title, content, onSave) {
            console.log('showModal вызвана:', title);
            
            if (confirm(`Модальное окно: ${title}\n\nНажмите OK для симуляции сохранения`)) {
                if (onSave) {
                    onSave();
                }
            }
        }

        function testDefectFunction() {
            const status = document.getElementById('status');
            status.innerHTML = 'Тестируем функцию...<br>';
            
            try {
                // Проверяем, доступна ли функция
                if (typeof window.showDefectModal === 'function') {
                    status.innerHTML += '✅ Функция showDefectModal найдена<br>';
                    window.showDefectModal(1);
                } else {
                    status.innerHTML += '❌ Функция showDefectModal не найдена<br>';
                    status.innerHTML += 'Попробуем загрузить файл...<br>';
                    
                    // Загружаем скрипт
                    const script = document.createElement('script');
                    script.src = 'js/board_defect.js';
                    script.onload = () => {
                        status.innerHTML += '✅ Скрипт board_defect.js загружен<br>';
                        if (typeof window.showDefectModal === 'function') {
                            status.innerHTML += '✅ Функция showDefectModal теперь доступна<br>';
                            window.showDefectModal(1);
                        } else {
                            status.innerHTML += '❌ Функция showDefectModal все еще недоступна<br>';
                        }
                    };
                    script.onerror = () => {
                        status.innerHTML += '❌ Ошибка загрузки board_defect.js<br>';
                    };
                    document.head.appendChild(script);
                }
            } catch (error) {
                status.innerHTML += `❌ Ошибка: ${error.message}<br>`;
            }
        }
    </script>
</body>
</html>
