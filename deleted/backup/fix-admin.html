<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ê–¥–º–∏–Ω–∞</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app" style="padding: 40px; max-width: 600px; margin: 0 auto;">
        <h1>üîß –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –°–∏—Å—Ç–µ–º—ã</h1>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h3>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</h3>
            <div id="status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 15px;">
            <button onclick="checkStatus()" class="btn btn-primary">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            <button onclick="fixAdmin()" class="btn btn-success">üëë –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω–∞</button>
            <button onclick="resetToDefaults()" class="btn btn-warning">üóëÔ∏è –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å</button>
            <button onclick="testLogin()" class="btn btn-secondary">üö™ –¢–µ—Å—Ç –≤—Ö–æ–¥–∞</button>
        </div>
        
        <div id="result" style="margin-top: 30px; padding: 20px; border-radius: 8px;"></div>
    </div>
    
    <script src="js/data.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/board.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        function showResult(message, isError = false) {
            const result = document.getElementById('result');
            result.innerHTML = message;
            result.style.background = isError ? '#ffe6e6' : '#e6ffe6';
            result.style.color = isError ? '#d63384' : '#198754';
            result.style.border = `1px solid ${isError ? '#d63384' : '#198754'}`;
        }
        
        function checkStatus() {
            try {
                loadData();
                
                const admin = data.users.find(u => u.isAdmin);
                const currentUser = loadCurrentUser() ? data.currentUser : null;
                
                let status = '<h4>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:</h4>';
                status += `<p><strong>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong> ${data.users.length}</p>`;
                status += `<p><strong>–ê–¥–º–∏–Ω –Ω–∞–π–¥–µ–Ω:</strong> ${admin ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</p>`;
                
                if (admin) {
                    status += `<p><strong>–ò–º—è –∞–¥–º–∏–Ω–∞:</strong> ${admin.name}</p>`;
                    status += `<p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${admin.phone}</p>`;
                    status += `<p><strong>–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞:</strong> ${admin.isAdmin ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç'}</p>`;
                }
                
                status += `<p><strong>–¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è:</strong> ${currentUser ? currentUser.name + (currentUser.isAdmin ? ' (–ê–¥–º–∏–Ω)' : ' (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)') : '–ù–µ—Ç'}</p>`;
                status += `<p><strong>–ü—Ä–æ—Ü–µ—Å—Å–æ–≤:</strong> ${data.processes.length}</p>`;
                status += `<p><strong>–ò–∑–¥–µ–ª–∏–π:</strong> ${data.products.length}</p>`;
                status += `<p><strong>–ó–∞–∫–∞–∑–æ–≤:</strong> ${data.orders.length}</p>`;
                
                document.getElementById('status').innerHTML = status;
                
                if (!admin) {
                    showResult('‚ùå –ê–¥–º–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω! –ù—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.', true);
                } else if (!admin.isAdmin) {
                    showResult('‚ùå –£ –∞–¥–º–∏–Ω–∞ –Ω–µ—Ç –ø—Ä–∞–≤! –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.', true);
                } else {
                    showResult('‚úÖ –ê–¥–º–∏–Ω –≤ –ø–æ—Ä—è–¥–∫–µ!');
                }
                
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ' + error.message, true);
            }
        }
        
        function fixAdmin() {
            try {
                loadData();
                
                // –ò—â–µ–º –∞–¥–º–∏–Ω–∞
                let admin = data.users.find(u => u.isAdmin);
                
                if (!admin) {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞
                    admin = {
                        id: 1,
                        name: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
                        phone: "+7 777 777 7777",
                        password: "1488",
                        isAdmin: true,
                        processes: [],
                        canCreateOrders: true
                    };
                    
                    data.users.unshift(admin);
                    showResult('‚úÖ –ù–æ–≤—ã–π –∞–¥–º–∏–Ω —Å–æ–∑–¥–∞–Ω!');
                } else {
                    // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
                    admin.isAdmin = true;
                    admin.canCreateOrders = true;
                    admin.processes = [];
                    showResult('‚úÖ –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');
                }
                
                saveData();
                sessionStorage.removeItem('currentUser'); // –û—á–∏—â–∞–µ–º —Å–µ—Å—Å–∏—é
                
                checkStatus(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: ' + error.message, true);
            }
        }
        
        function testLogin() {
            try {
                loadData();
                
                // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
                data.currentUser = null;
                sessionStorage.removeItem('currentUser');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
                showLoginScreen();
                showResult('‚úÖ –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –∫–∞–∫ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å –ø–∞—Ä–æ–ª–µ–º 1488');
                
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ –≤—Ö–æ–¥–∞: ' + error.message, true);
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(checkStatus, 500);
        });
    </script>
</body>
</html>