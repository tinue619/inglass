<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM System - –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèóÔ∏è CRM System - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —è–¥—Ä–æ</h1>
        <p>–õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</p>
        
        <div id="loading-status">
            <div class="status info">üì• –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π...</div>
        </div>
        
        <div id="app-container" style="display: none;">
            <h2>‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞</h2>
            <div id="app"></div>
        </div>
        
        <div id="debug-info" style="margin-top: 20px;">
            <h3>üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <button class="btn" onclick="showDebugInfo()">–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
            <button class="btn" onclick="testNewCore()">–¢–µ—Å—Ç —è–¥—Ä–∞</button>
            <button class="btn" onclick="location.reload()">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
            <div id="debug-output"></div>
        </div>
    </div>
    
    <script>
        window.loadingErrors = [];
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('loading-status');
            const statusClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            statusDiv.innerHTML += `<div class="status ${statusClass}">${message}</div>`;
            console.log(message);
        }
        
        function showDebugInfo() {
            const output = document.getElementById('debug-output');
            const info = {
                '–ë—Ä–∞—É–∑–µ—Ä': navigator.userAgent,
                'URL': window.location.href,
                '–û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏': loadingErrors,
                '–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã': {
                    'App': typeof window.App !== 'undefined',
                    'DataManager': typeof window.DataManager !== 'undefined',
                    'AuthModule': typeof window.AuthModule !== 'undefined',
                    'AppModule': typeof window.AppModule !== 'undefined',
                    'APIService': typeof window.APIService !== 'undefined'
                }
            };
            
            if (window.App && window.App.getStats) {
                info['–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ App'] = window.App.getStats();
            }
            
            output.innerHTML = '<pre>' + JSON.stringify(info, null, 2) + '</pre>';
        }
        
        function testNewCore() {
            const output = document.getElementById('debug-output');
            let testResults = [];
            
            try {
                // –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (window.App && window.App.users) {
                    const testUser = window.App.users.create({
                        name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                        phone: '+7 999 123 4567',
                        isAdmin: true
                    });
                    testResults.push('‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: OK');
                    
                    // –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
                    const testProcess = window.App.processes.create({
                        name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å',
                        order: 1
                    });
                    testResults.push('‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞: OK');
                    
                    // –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
                    const testOrder = window.App.orders.create({
                        productId: 1,
                        client: '–¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç',
                        quantity: 1
                    });
                    testResults.push('‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞: OK');
                    
                    // –¢–µ—Å—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
                    testOrder.moveToProcess(testProcess.id, {
                        userName: '–¢–µ—Å—Ç–µ—Ä',
                        reason: '–¢–µ—Å—Ç–æ–≤–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ'
                    });
                    testResults.push('‚úÖ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞: OK');
                    
                } else {
                    testResults.push('‚ùå App.users –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
            } catch (error) {
                testResults.push('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ' + error.message);
            }
            
            output.innerHTML = '<div class="status info"><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>' + 
                              testResults.join('<br>') + '</div>';
        }
        
        updateStatus('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É...');
    </script>
    
    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É -->
    <script src="js/utils/constants.js" onload="updateStatus('‚úÖ Constants –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: constants.js', 'error'); loadingErrors.push('constants.js')"></script>
    <script src="js/utils/config.js" onload="updateStatus('‚úÖ Config –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: config.js', 'error'); loadingErrors.push('config.js')"></script>
    <script src="js/utils/phoneUtils.js" onload="updateStatus('‚úÖ PhoneUtils –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: phoneUtils.js', 'error'); loadingErrors.push('phoneUtils.js')"></script>
    <script src="js/utils/contactEntities.js" onload="updateStatus('‚úÖ ContactEntities –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: contactEntities.js', 'error'); loadingErrors.push('contactEntities.js')"></script>
    <script src="js/utils/orderUtils.js" onload="updateStatus('‚úÖ OrderUtils –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: orderUtils.js', 'error'); loadingErrors.push('orderUtils.js')"></script>
    
    <script src="js/services/APIService.js" onload="updateStatus('‚úÖ APIService –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: APIService.js', 'error'); loadingErrors.push('APIService.js')"></script>
    
    <script src="js/core/entities.js" onload="updateStatus('‚úÖ Entities –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: entities.js', 'error'); loadingErrors.push('entities.js')"></script>
    <script src="js/core/managers.js" onload="updateStatus('‚úÖ Managers –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: managers.js', 'error'); loadingErrors.push('managers.js')"></script>
    <script src="js/core/app.js" onload="updateStatus('‚úÖ App Core –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: app.js', 'error'); loadingErrors.push('app.js')"></script>
    
    <script src="js/modules/modalModule.js" onload="updateStatus('‚úÖ ModalModule –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: modalModule.js', 'error'); loadingErrors.push('modalModule.js')"></script>
    <script src="js/modules/authModule.js" onload="updateStatus('‚úÖ AuthModule –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: authModule.js', 'error'); loadingErrors.push('authModule.js')"></script>
    <script src="js/modules/boardModule.js" onload="updateStatus('‚úÖ BoardModule –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: boardModule.js', 'error'); loadingErrors.push('boardModule.js')"></script>
    <script src="js/modules/defectModule.js" onload="updateStatus('‚úÖ DefectModule –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: defectModule.js', 'error'); loadingErrors.push('defectModule.js')"></script>
    <script src="js/modules/adminModule.js" onload="updateStatus('‚úÖ AdminModule –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: adminModule.js', 'error'); loadingErrors.push('adminModule.js')"></script>
    <script src="js/modules/appModule.js" onload="updateStatus('‚úÖ AppModule –∑–∞–≥—Ä—É–∂–µ–Ω')" onerror="updateStatus('‚ùå –û—à–∏–±–∫–∞: appModule.js', 'error'); loadingErrors.push('appModule.js')"></script>
    
    <!-- –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ -->
    <script>
        setTimeout(() => {
            updateStatus('üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
            
            if (loadingErrors.length > 0) {
                updateStatus('‚ùå –ù–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ —Ñ–∞–π–ª–∞—Ö: ' + loadingErrors.join(', '), 'error');
            } else {
                updateStatus('‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
                const components = ['App', 'DataManager', 'AuthModule', 'AppModule', 'APIService'];
                const available = components.filter(comp => typeof window[comp] !== 'undefined');
                const missing = components.filter(comp => typeof window[comp] === 'undefined');
                
                if (available.length > 0) {
                    updateStatus('‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: ' + available.join(', '), 'success');
                }
                
                if (missing.length > 0) {
                    updateStatus('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: ' + missing.join(', '), 'error');
                } else {
                    updateStatus('üéâ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!', 'success');
                    document.getElementById('app-container').style.display = 'block';
                    
                    // –ü—ã—Ç–∞–µ–º—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    if (window.App && typeof window.App.init === 'function') {
                        updateStatus('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è App...', 'info');
                        window.App.init().then(() => {
                            updateStatus('‚úÖ App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                            if (window.AuthModule && window.AuthModule.showLoginScreen) {
                                document.getElementById('app').innerHTML = '<div class="status success">‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞! –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ index.html –¥–ª—è –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏.</div>';
                            }
                        }).catch(error => {
                            updateStatus('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ App: ' + error.message, 'error');
                        });
                    }
                }
            }
        }, 1000);
    </script>
</body>
</html>
